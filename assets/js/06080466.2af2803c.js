"use strict";(self.webpackChunkakita_docs=self.webpackChunkakita_docs||[]).push([[3430],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return y}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var d=o.createContext({}),l=function(e){var t=o.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(d.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,d=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=l(n),m=a,y=c["".concat(d,".").concat(m)]||c[m]||u[m]||r;return n?o.createElement(y,i(i({ref:t},p),{},{components:n})):o.createElement(y,i({ref:t},p))}));function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s[c]="string"==typeof e?e:a,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5065:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return d},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c}});var o=n(3117),a=n(102),r=(n(7294),n(3905)),i=["components"],s={title:"Entity Store"},d=void 0,l={unversionedId:"entities/entity-store",id:"entities/entity-store",title:"Entity Store",description:"For the most part, the stores you'll require in your applications will be entity stores. You can think of an entity store as a table in a database, where each table represents a flat collection of entities.",source:"@site/docs/entities/entity-store.mdx",sourceDirName:"entities",slug:"/entities/entity-store",permalink:"/akita/docs/entities/entity-store",draft:!1,editUrl:"https://github.com/salesforce/akita/edit/master/docs/docs/entities/entity-store.mdx",tags:[],version:"current",frontMatter:{title:"Entity Store"},sidebar:"docs",previous:{title:"Store Config",permalink:"/akita/docs/config"},next:{title:"Query Entity",permalink:"/akita/docs/entities/query-entity"}},p={},c=[{value:"Extend the Entity Store",id:"extend-the-entity-store",level:2},{value:"Entity Id",id:"entity-id",level:2},{value:"Nested Entity Id",id:"nested-entity-id",level:3},{value:"API",id:"api",level:2},{value:"<code>set()</code>",id:"set",level:3},{value:"<code>add()</code>",id:"add",level:3},{value:"<code>update()</code>",id:"update",level:3},{value:"<code>remove()</code>",id:"remove",level:3},{value:"<code>upsert()</code>",id:"upsert",level:3},{value:"<code>upsertMany()</code>",id:"upsertmany",level:3},{value:"<code>replace()</code>",id:"replace",level:3},{value:"<code>move()</code>",id:"move",level:3},{value:"<code>setLoading()</code>",id:"setloading",level:3},{value:"<code>setError()</code>",id:"seterror",level:3}],u={toc:c};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"For the most part, the stores you'll require in your applications will be entity stores. You can think of an entity store as a table in a database, where each table represents a flat collection of entities.\nAkita's ",(0,r.kt)("inlineCode",{parentName:"p"},"EntityStore")," simplifies the process, giving you everything you need to manage it."),(0,r.kt)("p",null,"Let's see how we can use it to create a ",(0,r.kt)("inlineCode",{parentName:"p"},"todos")," table, i.e., an ",(0,r.kt)("inlineCode",{parentName:"p"},"EntityStore")," managing a ",(0,r.kt)("inlineCode",{parentName:"p"},"Todo")," object:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todos.store.ts"',title:'"todos.store.ts"'},"import { EntityState, EntityStore, StoreConfig } from '@datorama/akita';\nimport { Todo } from './todo.model';\n\nexport interface TodosState extends EntityState<Todo, number> { }\n\n@StoreConfig({ name: 'todos' })\nexport class TodosStore extends EntityStore<TodosState> {\n  constructor() {\n    super() ;\n  }\n}\n")),(0,r.kt)("p",null,"First, we need to define the store's interface. In our case, we can make do with extending the ",(0,r.kt)("inlineCode",{parentName:"p"},"EntityState")," from Akita, providing it with the ",(0,r.kt)("inlineCode",{parentName:"p"},"Todo")," Entity type and the ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," type, which in our case is a ",(0,r.kt)("inlineCode",{parentName:"p"},"number"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"EntityState")," has the following signature:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface EntityState<Entity = any, IDType = any> {\n  entities: HashMap<Entity>;\n  ids: IDType[];\n  loading: boolean;\n  error: any;\n}\n"))),(0,r.kt)("h2",{id:"extend-the-entity-store"},"Extend the Entity Store"),(0,r.kt)("p",null,"Sometimes it's useful to extend the store and add more properties to it, for example, you might want to save the todos active filter.\nTo do so, first, we need to update our interface with the ",(0,r.kt)("inlineCode",{parentName:"p"},"property")," type:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{5} title="todos.store.ts"',"{5}":!0,title:'"todos.store.ts"'},"import { EntityState, EntityStore, StoreConfig } from '@datorama/akita';\nimport { Todo } from './todo.model';\n\nexport interface TodosState extends EntityState<Todo, number> {\n  filter: string;\n}\n")),(0,r.kt)("p",null,"Next, if we want to pass an initial state for this property, we can do it in the constructor as we did with a Store:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{11} title="todos.store.ts"',"{11}":!0,title:'"todos.store.ts"'},"import { EntityState, EntityStore, StoreConfig } from '@datorama/akita';\nimport { Todo } from './todo.model';\n\nexport interface TodosState extends EntityState<Todo, number> {\n  filter: string;\n}\n\n@StoreConfig({ name: 'todos' })\nexport class TodosStore extends EntityStore<TodosState> {\n  constructor() {\n    super({ filter: 'ALL' });\n  }\n}\n")),(0,r.kt)("p",null,"Now we can update the property by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"update()")," method. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"store.update({ filter: 'COMPLETED' });\n")),(0,r.kt)("h2",{id:"entity-id"},"Entity Id"),(0,r.kt)("p",null,"By default, Akita takes the ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," key from the entity ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," field. To change it, you can pass the ",(0,r.kt)("inlineCode",{parentName:"p"},"idKey")," option to the store config:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="todos.store.ts"',title:'"todos.store.ts"'},"export interface TodosState extends EntityState<Todo, number> {}\n\n@StoreConfig({ name: 'todos', idKey: '_id' })\nexport class TodosStore extends EntityStore<TodosState> {\n  constructor() {\n    super();\n  }\n}\n")),(0,r.kt)("h3",{id:"nested-entity-id"},"Nested Entity Id"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"idKey")," can only specify a top-level property of an entity.\nIn cases an Entity Id is nested in the object, we can use ",(0,r.kt)("a",{parentName:"p",href:"../additional/middleware"},"Store Middlware")," to populate the ",(0,r.kt)("inlineCode",{parentName:"p"},"idKey")," field."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{3-5} title="todo.model"',"{3-5}":!0,title:'"todo.model"'},"export interface Todo {\n  description: string;\n  nested: {\n    id: number;\n  };\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'{9-14} title="todos.store.ts"',"{9-14}":!0,title:'"todos.store.ts"'},"export interface TodosState extends EntityState<Todo, number> {}\n\n@StoreConfig({ name: 'todos', idKey: '_id' })\nexport class TodosStore extends EntityStore<TodosState> {\n  constructor() {\n    super();\n  }\n  \n  akitaPreAddEntity(newEntity: Todo): Todo & { _id: string; } {\n    return {\n      ...newEntity,\n      _id: newEntity.nested.id,\n    };\n  }\n}\n")),(0,r.kt)("p",null,"By using this model, you will receive a lot of built-in functionality from Akita:"),(0,r.kt)("h2",{id:"api"},"API"),(0,r.kt)("h3",{id:"set"},(0,r.kt)("inlineCode",{parentName:"h3"},"set()")),(0,r.kt)("p",null,"Replace current collection with the provided collection, and ",(0,r.kt)("strong",{parentName:"p"},"resets")," the active entity:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Pass an array\nstore.set([ Entity, Entity ]);\n// Pass an object\nstore.set({ 1: Entity, 2: Entity });\n// Set the active id\nstore.set([ Entity, Entity ], { activeId: 1 });\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you pass an object, Akita doesn't guarantee the order of the data received.")),(0,r.kt)("h3",{id:"add"},(0,r.kt)("inlineCode",{parentName:"h3"},"add()")),(0,r.kt)("p",null,"Add an entity or entities to the store:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Add multiple\nstore.add([Entity, Entity]);\n// Add one\nstore.add(Entity);\n\n// Prepend\nstore.add([Entity, Entity], { prepend: true });\nstore.add(Entity, { prepend: true })\n")),(0,r.kt)("h3",{id:"update"},(0,r.kt)("inlineCode",{parentName:"h3"},"update()")),(0,r.kt)("p",null,"Update an entity or entities in the store:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Update one\nstore.update(entityId, { name: 'New Name' });\n\n// Use a predicate function\nstore.update(({ name }) => name === 'John', {\n  name: 'New Name'\n});\n\n// Use a callback function\nstore.update(entityId, entity => {\n  return {\n    config: {\n      ...entity.config,\n      date\n    }\n  }\n});\n\n// Update multiple\nstore.update([id, id, id], { count: 5 });\n\n// Update all\nstore.update(null, { name: 'New Name' });\n")),(0,r.kt)("h3",{id:"remove"},(0,r.kt)("inlineCode",{parentName:"h3"},"remove()")),(0,r.kt)("p",null,"Remove one or more entities from the store:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Remove one\nstore.remove(5);\n\n// Remove multiple\nstore.remove([1,2,3]);\n\n// Remove by predicate\nstore.remove(({ name }) => name === 'John');\n\n// Remove all\nstore.remove();\n")),(0,r.kt)("h3",{id:"upsert"},(0,r.kt)("inlineCode",{parentName:"h3"},"upsert()")),(0,r.kt)("p",null,"Insert or update an entity. Creates a new entity when no entity matches the ",(0,r.kt)("inlineCode",{parentName:"p"},"id"),"; otherwise, it performs an update:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"store.upsert(id, { isOpen: true }, (id, newState) => ({ id, ...newState });\nstore.upsert(id, (oldState) => ({ isOpen: !(oldState?.isOpen ?? true) }), (id, newState) => ({ id, ...newState });\n")),(0,r.kt)("p",null,"The first argument is the entity id to be inserted or updated, the second contains the new entity state, and the last\nargument is the callback for creating a new entity if it does not exist."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"The initializing callback parameter can be omitted, but then type safety of entities cannot be guaranteed. Use\nthis if all state properties are declared optional or if manually type check for ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined"),".")),(0,r.kt)("h3",{id:"upsertmany"},(0,r.kt)("inlineCode",{parentName:"h3"},"upsertMany()")),(0,r.kt)("p",null,"Insert or update multiple entities. Creates a new entity when no entity matches the ",(0,r.kt)("inlineCode",{parentName:"p"},"id"),"; otherwise, it performs an update:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"store.upsertMany([entity, entity]);\n")),(0,r.kt)("h3",{id:"replace"},(0,r.kt)("inlineCode",{parentName:"h3"},"replace()")),(0,r.kt)("p",null,"Replace an entity (except the ",(0,r.kt)("inlineCode",{parentName:"p"},"id"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"store.replace(id, newEntity);\nstore.replace([id, id, id], newEntity);\n")),(0,r.kt)("h3",{id:"move"},(0,r.kt)("inlineCode",{parentName:"h3"},"move()")),(0,r.kt)("p",null,"Move an entity from the current ",(0,r.kt)("inlineCode",{parentName:"p"},"index")," to a new ",(0,r.kt)("inlineCode",{parentName:"p"},"index"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"store.move(fromIndex, toIndex);\n")),(0,r.kt)("h3",{id:"setloading"},(0,r.kt)("inlineCode",{parentName:"h3"},"setLoading()")),(0,r.kt)("p",null,"Update the store's ",(0,r.kt)("inlineCode",{parentName:"p"},"loading")," state. The initial value is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," and is switched to ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," when you call ",(0,r.kt)("inlineCode",{parentName:"p"},"store.set()"),". This can come in handy for indicating ",(0,r.kt)("inlineCode",{parentName:"p"},"loading"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"store.setLoading(true);\n")),(0,r.kt)("h3",{id:"seterror"},(0,r.kt)("inlineCode",{parentName:"h3"},"setError()")),(0,r.kt)("p",null,"Update the store's ",(0,r.kt)("inlineCode",{parentName:"p"},"error")," state:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"store.setError(error);\n")))}m.isMDXComponent=!0}}]);